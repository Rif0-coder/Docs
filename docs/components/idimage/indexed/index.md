## Индексация товаров

Для получения списка похожих товаров необходимо выполнить несколько шагов:

* создать товары с изображениями
* провести векторизацию и выполнить индексацию.

### Опции и настройки
- [Типы индексации](/components/idimage/indexed/type)
- [Настройка категорий](/components/idimage/indexed/category)


### 1. Создание товаров

Перейдите на вкладку **Пакеты → ID image → Товары** и нажмите **«Создать товары»**.

![Создание товаров](https://file.modx.pro/files/f/9/1/f913d8f210e5408854ae321fec346c07.png)

*Запустится процесс создания товаров. Дождитесь его завершения.*

![Процесс создания](https://file.modx.pro/files/d/d/3/dd37a1f018357036fe373438a00930f7.png)

После завершения процесса в списке появятся товары, готовые для векторизации и индексации.

![Список товаров для индексации](https://file.modx.pro/files/0/3/f/03f38272a8d832d9b71dcb317901118b.png)

### 2. Получение векторов

В разделе **Действия** выберите **«Загрузить изображения»**. Будет создан список заданий для запроса в сервис idimage.ru.

![Загрузка изображений](https://file.modx.pro/files/d/c/e/dce673b28847fb2a37b86394b6e17a55.png)

*После создания заданий для загрузки изображений появится запрос на запуск очереди. Нажмите **«Да»**.*

![Отправка изображений](https://file.modx.pro/files/0/2/d/02de950a547965552816dc8949d873ad.png)

Дождитесь завершения загрузки, не закрывайте окно.

::: warning Важно

- Получение векторов может занять значительное время. За один проход обрабатывается 20 изображений.
- Время выполнения одного прохода зависит от скорости интернета и загруженности сервиса idimage.ru, время запроса может составить от 1 секунды и более.
  :::

### 3. Индексация товаров

В разделе **Действия** выберите **«Индексировать товары»**. Будет создан список заданий для индексации.

![Индексация товаров](https://file.modx.pro/files/e/9/9/e9907ff791dc0ee2d78023866b52495e.png)

*После создания заданий появится запрос на запуск очереди для получения похожих товаров. Подтвердите действие или вы может позже запустить очередь на вкладке "**Задания**".*

::: warning Важно

- Убедитесь, что для всех изображений получены вектора.
- Индексация может занять значительное время. Скорость выполнения зависит от количества товаров и мощности сервера. Чем больше товаров, тем дольше занимает
  процесс.
  :::

### 4. Размещение сниппета на странице

В **MiniShop2** уже есть готовый сниппет для выборки товаров — **[msProducts](/components/minishop2/snippets/msproducts#msproducts)**, поэтому будем
использовать его в примере.

#### Шаг 1: Вставка кода в шаблон карточки товара

Добавьте следующий код в шаблон карточки товара:

```fenom
{var $ids = $modx->runSnippet('idImageSimilar', [
    'pid' => $modx->resource->id,
    'min_scope' => 65,
    'limit' => 4
])}

{if $ids}
    {$modx->runSnippet('msProducts', [
        'resources' => $ids,
        'sortby' => "FIELD(msProduct.id, {$ids})",
        'parents' => 0,
    ])}
{/if}
```


## Задания

Задания необходимы для бесперебойного процесса индексации и векторизации.
Вы можете управлять очередью заданий вручную или настроить их автоматический запуск в [фоновом режиме](/components/idimage/crontab).


![Задания](https://file.modx.pro/files/e/4/0/e404e2125513ec70bd193c734e881a56.png)
